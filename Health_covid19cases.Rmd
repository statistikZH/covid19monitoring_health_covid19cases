---
title: "covid19_Grossregion"
---

# r setup

```{r}

# Import libraries
library(dplyr) # Version: ‘0.8.5’
library(tidyr) # ‘1.0.2’
library(lubridate) # ‘1.7.4’

# Number formatting
options(scipen = 1000000)
options(digits = 6)

```

# import dat

```{r}

#cases
url_cases  <- "https://raw.githubusercontent.com/openZH/covid_19/master/COVID19_Fallzahlen_CH_total.csv"
cases <- read.csv(url(url_cases), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")

#grossregion
grossregion <- read.csv("KantonGrossregion.csv", header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
cases_sel <- cases %>%
  select(date, ncumul_conf, ncumul_deceased, abbreviation_canton_and_fl) %>%
  left_join(grossregion, by= c("abbreviation_canton_and_fl" = "Kanton")) %>%
  group_by(date, Grossregion_Name)%>%
  summarize(
    ncumul_conf = sum(ncumul_conf, na.rm = FALSE),
    ncumul_deceased = sum(ncumul_deceased, na.rm = FALSE)
  ) %>%
  ungroup() %>%
  group_by(Grossregion_Name) %>%
  mutate(
    ncumul_conf = ifelse(is.na(ncumul_conf), 0, ncumul_conf),
    ncumul_deceased = ifelse(is.na(ncumul_deceased), 0 , ncumul_deceased),
    sarscov2_faelle = ifelse(date == min(date)	, ncumul_conf,  ncumul_conf - lag(ncumul_conf, n = 1)),
    sarscov2_verstorbene = ifelse(date == min(date)	, ncumul_deceased,  ncumul_deceased - lag(ncumul_deceased, n = 1))
  ) 

cases_sel<-reshape2::melt(cases_sel, id.vars=c("date", "Grossregion_Name"))
covid19<-data.frame(date=as.POSIXct(paste(cases_sel$date, "00:00:00", sep=" ")),
                       value=cases_sel$value,
                       topic="Gesundheit",
                       variable_short=cases_sel$variable,
                       variable_long=ifelse(cases_sel$variable=="ncumul_conf", 
                                            "Gemeldete Anzahl SARS-CoV-2 Fällen", 
                                            "Gemeldete Anzahl SARS-CoV-2 Verstorbenen"),
                       location=cases_sel$Grossregion_Name,
                       unit="Anzahl",
                       source="Gesundheitsdirektion Kanton Zürich",
                       update="täglich",
                       public="ja",
                       description="https://github.com/statistikZH/covid19monitoring_health_covid19cases")

write.table(covid19, "Health_covid19cases.csv", sep=",", fileEncoding="UTF-8", row.names = F)

```

# auffälligkeiten
- Es gibt einige Minuswerte
